(ns dsp-calculator.devcards.icons
  (:require [clojure.tools.reader.edn :as edn]
            [devcards.core :as dc]
            [reagent.core :as reagent]
            [dsp-calculator.data :as dsp-data]
            [spade.core :refer [defattrs]]
            [ajax.core :refer [GET]]
            [ajax.edn]
            [clojure.string :as str])
  (:require-macros
   [devcards.core :as dc :refer [defcard defcard-rg]]))

(declare icons)

(defn receive-edn [ratom response]
  (.log js/console (str response))
  (reset! ratom response))

(defn error-handler [type {:keys [status status-text]}]
  (.log js/console (str "Error fetching " type ". " status " " status-text)))

(defattrs icons-attrs []
  {:background "black"
   :display "grid"
   :grid-template-columns "repeat(auto-fill, minmax(80px, 1fr))"
   :place-items "center"
   :grid-gap "20px"
   :padding "30px"})

(defn icons-list [type xs]
  [:div (icons-attrs)
   (for [x xs]
     [:div.icon {:data-icon (str type "." (:id x))}])])

(defn fetch-button [type ratom]
  (when (not (seq @ratom))
    [:button {:type "button"
              :on-click (fn [] (GET (str "/data/" type ".edn")
                                 {:handler #(receive-edn ratom %)
                                  :error-handler #(error-handler type %)
                                  :response-format (ajax.edn/edn-response-format)}))}
     (str "Fetch " (str/capitalize type))]))

(defcard-rg icons-css
  "This includes the css for displaying icons into the page."
  [:div
   [:link {:rel "stylesheet" :href "/css/icons.css"}]])

(def valid-recipe-icons
  #{16 29 32 35 54 58 61 62 69 74 79 100 115 121})

(defcard-rg recipe-icons
  (fn [recipes _]
    [:div
     [fetch-button "recipes" recipes]
     [icons-list "recipe" (filter #(valid-recipe-icons (:id %))@recipes)]])
  (reagent/atom []))

(defcard-rg item-icons
  (fn [items _]
    [:div
     [fetch-button "items" items]
     [icons-list "item" @items]])
  (reagent/atom []))

(defcard-rg tech-icons
  (fn [tech _]
    [:div
     [fetch-button "tech" tech]
     [icons-list "tech" @tech]])
  (reagent/atom []))

(defcard-rg icons
  [:div (icons-attrs)
   (for [icon icons]
     [:div.icon {:data-icon icon}])])

(def icons
  ["item.1001"
   "item.1002"
   "item.1003"
   "item.1004"
   "item.1005"
   "item.1006"
   "item.1030"
   "item.1031"
   "item.1011"
   "item.1012"
   "item.1013"
   "item.1014"
   "item.1015"
   "item.1016"
   "item.1101"
   "item.1104"
   "item.1105"
   "item.1106"
   "item.1108"
   "item.1109"
   "item.1103"
   "item.1107"
   "item.1110"
   "item.1119"
   "item.1111"
   "item.1112"
   "item.1113"
   "item.1201"
   "item.1102"
   "item.1202"
   "item.1203"
   "item.1204"
   "item.1205"
   "item.1206"
   "item.1127"
   "item.1301"
   "item.1303"
   "item.1305"
   "item.1302"
   "item.1304"
   "item.1402"
   "item.1401"
   "item.1404"
   "item.1501"
   "item.1000"
   "item.1007"
   "item.1114"
   "item.1116"
   "item.1120"
   "item.1121"
   "item.1122"
   "item.1208"
   "item.1801"
   "item.1802"
   "item.1803"
   "item.1804"
   "item.1115"
   "item.1123"
   "item.1124"
   "item.1117"
   "item.1118"
   "item.1126"
   "item.1128"
   "item.1129"
   "item.1130"
   "item.1209"
   "item.1210"
   "item.1403"
   "item.1407"
   "item.1405"
   "item.1406"
   "item.5003"
   "item.5001"
   "item.5002"
   "item.1125"
   "item.1502"
   "item.1503"
   "item.1131"
   "item.1141"
   "item.1142"
   "item.1143"
   "item.1601"
   "item.1602"
   "item.1603"
   "item.1604"
   "item.1605"
   "item.1606"
   "item.1607"
   "item.1608"
   "item.1609"
   "item.1610"
   "item.1611"
   "item.1612"
   "item.1613"
   "item.5101"
   "item.5102"
   "item.5103"
   "item.5111"
   "item.5112"
   "item.5201"
   "item.5202"
   "item.5203"
   "item.5204"
   "item.5205"
   "item.5206"
   "item.2001"
   "item.2002"
   "item.2003"
   "item.2011"
   "item.2012"
   "item.2013"
   "item.2014"
   "item.2020"
   "item.2040"
   "item.2030"
   "item.2313"
   "item.2107"
   "item.2101"
   "item.2102"
   "item.2106"
   "item.2303"
   "item.2304"
   "item.2305"
   "item.2318"
   "item.2201"
   "item.2202"
   "item.2212"
   "item.2203"
   "item.2204"
   "item.2211"
   "item.2213"
   "item.2301"
   "item.2316"
   "item.2306"
   "item.2302"
   "item.2315"
   "item.2319"
   "item.2307"
   "item.2308"
   "item.2309"
   "item.2317"
   "item.2314"
   "item.2205"
   "item.2206"
   "item.2207"
   "item.2311"
   "item.2208"
   "item.2312"
   "item.2209"
   "item.2310"
   "item.2210"
   "item.2103"
   "item.2104"
   "item.2105"
   "item.2901"
   "item.2902"
   "item.3001"
   "item.3002"
   "item.3003"
   "item.3004"
   "item.3005"
   "item.3006"
   "item.3007"
   "item.3008"
   "item.3009"
   "item.3010"
   "item.6001"
   "item.6002"
   "item.6003"
   "item.6004"
   "item.6005"
   "item.6006"
   "recipe.16"
   "recipe.29"
   "recipe.32"
   "recipe.35"
   "recipe.54"
   "recipe.58"
   "recipe.61"
   "recipe.62"
   "recipe.69"
   "recipe.74"
   "recipe.79"
   "recipe.100"
   "recipe.115"
   "recipe.121"
   "tech.1"
   "tech.1001"
   "tech.1002"
   "tech.1101"
   "tech.1102"
   "tech.1103"
   "tech.1104"
   "tech.1111"
   "tech.1112"
   "tech.1113"
   "tech.1114"
   "tech.1120"
   "tech.1121"
   "tech.1122"
   "tech.1123"
   "tech.1124"
   "tech.1125"
   "tech.1126"
   "tech.1131"
   "tech.1132"
   "tech.1133"
   "tech.1134"
   "tech.1141"
   "tech.1142"
   "tech.1143"
   "tech.1144"
   "tech.1145"
   "tech.1151"
   "tech.1152"
   "tech.1153"
   "tech.1201"
   "tech.1202"
   "tech.1203"
   "tech.1302"
   "tech.1303"
   "tech.1304"
   "tech.1305"
   "tech.1311"
   "tech.1312"
   "tech.1401"
   "tech.1402"
   "tech.1403"
   "tech.1411"
   "tech.1412"
   "tech.1413"
   "tech.1414"
   "tech.1415"
   "tech.1416"
   "tech.1417"
   "tech.1501"
   "tech.1502"
   "tech.1503"
   "tech.1504"
   "tech.1505"
   "tech.1506"
   "tech.1507"
   "tech.1508"
   "tech.1511"
   "tech.1512"
   "tech.1513"
   "tech.1521"
   "tech.1522"
   "tech.1523"
   "tech.1601"
   "tech.1602"
   "tech.1603"
   "tech.1604"
   "tech.1605"
   "tech.1606"
   "tech.1607"
   "tech.1608"
   "tech.1701"
   "tech.1702"
   "tech.1703"
   "tech.1704"
   "tech.1705"
   "tech.1711"
   "tech.1712"
   "tech.1801"
   "tech.1802"
   "tech.1803"
   "tech.1804"
   "tech.1805"
   "tech.1806"
   "tech.1807"
   "tech.1808"
   "tech.1809"
   "tech.1810"
   "tech.1811"
   "tech.1812"
   "tech.1813"
   "tech.1814"
   "tech.1815"
   "tech.1816"
   "tech.1817"
   "tech.1818"
   "tech.1819"
   "tech.1820"
   "tech.1821"
   "tech.1822"
   "tech.1823"
   "tech.1824"
   "tech.1826"
   "tech.1901"
   "tech.1902"
   "tech.1903"
   "tech.1904"
   "tech.2101"
   "tech.2102"
   "tech.2103"
   "tech.2104"
   "tech.2105"
   "tech.2106"
   "tech.2201"
   "tech.2202"
   "tech.2203"
   "tech.2204"
   "tech.2205"
   "tech.2206"
   "tech.2207"
   "tech.2208"
   "tech.2301"
   "tech.2302"
   "tech.2303"
   "tech.2304"
   "tech.2305"
   "tech.2306"
   "tech.2307"
   "tech.2401"
   "tech.2402"
   "tech.2403"
   "tech.2404"
   "tech.2405"
   "tech.2406"
   "tech.2407"
   "tech.2501"
   "tech.2502"
   "tech.2503"
   "tech.2504"
   "tech.2505"
   "tech.2506"
   "tech.2601"
   "tech.2602"
   "tech.2603"
   "tech.2604"
   "tech.2605"
   "tech.2606"
   "tech.2701"
   "tech.2702"
   "tech.2703"
   "tech.2704"
   "tech.2705"
   "tech.2801"
   "tech.2802"
   "tech.2803"
   "tech.2804"
   "tech.2805"
   "tech.2806"
   "tech.2807"
   "tech.2901"
   "tech.2902"
   "tech.2903"
   "tech.2904"
   "tech.2905"
   "tech.2906"
   "tech.2951"
   "tech.2952"
   "tech.2953"
   "tech.2954"
   "tech.2955"
   "tech.2956"
   "tech.3101"
   "tech.3102"
   "tech.3103"
   "tech.3104"
   "tech.3105"
   "tech.3106"
   "tech.3201"
   "tech.3202"
   "tech.3203"
   "tech.3204"
   "tech.3205"
   "tech.3206"
   "tech.3207"
   "tech.3208"
   "tech.3301"
   "tech.3302"
   "tech.3303"
   "tech.3304"
   "tech.3305"
   "tech.3306"
   "tech.3311"
   "tech.3312"
   "tech.3313"
   "tech.3314"
   "tech.3315"
   "tech.3316"
   "tech.4001"
   "tech.4002"
   "tech.4003"
   "tech.4004"
   "tech.4005"
   "tech.3401"
   "tech.3402"
   "tech.3403"
   "tech.3404"
   "tech.3405"
   "tech.3406"
   "tech.3407"
   "tech.3501"
   "tech.3502"
   "tech.3503"
   "tech.3504"
   "tech.3505"
   "tech.3506"
   "tech.3507"
   "tech.3508"
   "tech.3509"
   "tech.3510"
   "tech.3801"
   "tech.3802"
   "tech.3803"
   "tech.3601"
   "tech.3602"
   "tech.3603"
   "tech.3604"
   "tech.3605"
   "tech.3606"
   "tech.3701"
   "tech.3702"
   "tech.3703"
   "tech.3704"
   "tech.3705"
   "tech.3706"
   "tech.3901"
   "tech.3902"
   "tech.3903"
   "tech.3904"
   "tech.4101"
   "tech.4102"
   "tech.4103"
   "tech.4104"
   "tech.5001"
   "tech.5002"
   "tech.5003"
   "tech.5004"
   "tech.5005"
   "tech.5006"
   "tech.5101"
   "tech.5102"
   "tech.5103"
   "tech.5104"
   "tech.5105"
   "tech.5106"
   "tech.5201"
   "tech.5202"
   "tech.5203"
   "tech.5204"
   "tech.5205"
   "tech.5206"
   "tech.5301"
   "tech.5302"
   "tech.5303"
   "tech.5304"
   "tech.5305"
   "tech.5401"
   "tech.5402"
   "tech.5403"
   "tech.5404"
   "tech.5405"
   "tech.5601"
   "tech.5602"
   "tech.5603"
   "tech.5604"
   "tech.5605"
   "tech.5701"
   "tech.5702"
   "tech.5703"
   "tech.5704"
   "tech.5705"
   "tech.5801"
   "tech.5802"
   "tech.5803"
   "tech.5804"
   "tech.5805"
   "tech.5806"
   "tech.5807"
   "tech.5901"
   "tech.5902"
   "tech.5903"
   "tech.5904"
   "tech.5905"
   "tech.5906"
   "tech.5907"
   "tech.6001"
   "tech.6002"
   "tech.6003"
   "tech.6004"
   "tech.6005"
   "tech.6006"
   "tech.6101"
   "tech.6102"
   "tech.6103"
   "tech.6104"
   "tech.6105"
   "tech.6106"])
